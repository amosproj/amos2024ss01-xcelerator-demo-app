<ix-content>
	<div class="grid grid-cols-[auto_250px] gap-10">
		<form
			class="needs-validation m-3 flex flex-col gap-y-10 w-5/6"
			[ngClass]="{ 'was-validated': wasValidated }"
			novalidate
			#caseForm="ngForm"
			(submit)="onSubmit(caseForm)"
		>
			<ix-select
				i18nPlaceholder="Select a Facility"
				i18nSelectListHeader="Please select a facility"
				name="selectFacility"
				[(ngModel)]="createCaseForm.selectFacility"
				required
			>
				@for (facility of facilities(); track facility.id) {
					<ix-select-item
						[label]="facility.heading"
						[value]="facility.id"
					></ix-select-item>
				}
			</ix-select>
			<div class="invalid-feedback">Please select a facility</div>
			
			<ix-input-group>
				<span slot="input-start">Title:</span>
				<input type="text" name="title" [(ngModel)]="createCaseForm.title" required/>
				<div class="invalid-feedback">Please insert a title</div>
			</ix-input-group>

			<ix-input-group>
				<textarea
					placeholder="Enter your Description"
					name="text"
					[(ngModel)]="createCaseForm.text"
					required
				></textarea>
			</ix-input-group>

			<ix-input-group class="flex flex-row gap-4">
				<ix-input-group>
					<ix-date-dropdown						
						range="false"
						[(ngModel)]="createCaseForm.dueDate"
						name="dueDate"
						format="yyyy-LL-dd"
						required
					>
					</ix-date-dropdown>
				</ix-input-group>
			
				<ix-select 
					name="selectType" 
					i18nPlaceholder="Type" 
					i18nSelectListHeader="Select type" 
					[(ngModel)]="createCaseForm.selectType" 
					required
				>
					<ix-select-item label="Planned" [value]="caseType.PLANNED"></ix-select-item>
					<ix-select-item label="Incident" [value]="caseType.INCIDENT"></ix-select-item>
					<ix-select-item label="Annotation" [value]="caseType.ANNOTATION"></ix-select-item>
				</ix-select>

				<ix-select 
					name="selectPriority" 
					i18nPlaceholder="Priority" 
					i18nSelectListHeader="Select the priority" 
					[(ngModel)]="createCaseForm.selectPriority" 
					required
				>
					<ix-select-item label="Low" [value]="casePriority.LOW"></ix-select-item>
					<ix-select-item label="Medium" [value]="casePriority.MEDIUM"></ix-select-item>
					<ix-select-item label="High" [value]="casePriority.HIGH"></ix-select-item>
					<ix-select-item label="Emergency" [value]="casePriority.EMERGENCY"></ix-select-item>
				</ix-select>
			</ix-input-group>

			<!-- Cases don't contain Phone Numbers
			<ix-input-group>
				<span slot="input-start">Telephone:</span>
				<input
					placeholder="111-111-111"
					type="tel"
					name="phone"
					[(ngModel)]="createCaseForm.phone"
					pattern="[+]?[0-9]+"
					maxlength="16"
					required
				/>
				<div class="valid-feedback">Looks good!</div>
				<div class="invalid-feedback">Please provide a valid phone number</div>
			</ix-input-group>
			-->
			
			<ix-input-group>
				<span slot="input-start">Email:</span>
				<input
					placeholder="example@domain.com"
					type="email"
					name="email"
					[(ngModel)]="createCaseForm.email"
					required
				/>
				<div class="valid-feedback">Looks good!</div>
				<div class="invalid-feedback">Please provide a valid email address</div>
			</ix-input-group>

			

			<ix-button type="submit"> Create Case </ix-button>
		</form>

		<div *ngIf="getFacilityValue() as facility">
			<ix-tile size="big" class="mr-1">
				<div class="mt-4" slot="header">{{ facility.heading }}</div>
				<div class="mt-7 text-l">{{ facility.subheading }}</div>
			</ix-tile>

			<ix-tile class="mt-2" size="small">Location: {{ facility.location }}</ix-tile>
			<ix-tile class="mt-2" size="small">Number of pumps: {{ facility.pumps }}</ix-tile>

			<ix-button 
				class="mt-4" 
				variant="secondary" 
				[routerLink]="['/facilities', facility.id]"
			>
				View Facility
			</ix-button>
		</div>
	</div>
</ix-content>
