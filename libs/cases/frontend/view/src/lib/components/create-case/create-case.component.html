<ix-content>
    <div class="grid grid-cols-[auto_250px] gap-10">
        <form
            class="needs-validation m-3 flex flex-col gap-y-10 w-5/6 "
            [ngClass]="{ 'was-validated': wasValidated }"
            novalidate
            #caseForm="ngForm"
            (submit)="onSubmit(caseForm)"
        >
            <!-- Facility Selection -->
            <ix-select
                id="facilitySelection"
                (valueChange)="onFacilityChange($event)"
                (inputChange)="onFacilityInputChange($event)"
            >
                @for (facility of facilities(); track facility.id) {
                    <ix-select-item
                        [label]="facility.heading"
                        [value]="facility.id"
                    ></ix-select-item>
                }
            </ix-select>
            <ix-input-group 
                class="absolute pointer-events-none" 
                id="input-facilitySelection"
            >
                <input
                    [(ngModel)]="createCaseForm.selectFacility"
                    placeholder="{{facilityPlaceholder()}}"
                    name="selectFacility"
                    required
                />
                <span slot="input-end">
                    <ix-icon name="chevron-down" size="16"/>
                </span>
            </ix-input-group>
            
            <!-- Case Title -->
            <ix-input-group>
                <span slot="input-start">Title:</span>
                <input 
                    type="text" 
                    name="title" 
                    [(ngModel)]="createCaseForm.title" 
                    required 
                />
                <div class="invalid-feedback">Please insert a title</div>
            </ix-input-group>

            <!-- Case Description -->
            <textarea
                placeholder="Enter your Description"
                class="pl-2"
                name="text"
                [(ngModel)]="createCaseForm.text"
                required
            ></textarea>

            <div class="flex flex-row gap-4">
                <!-- Date Selection -->
                <lib-date-dropdown-wrapper
                    [(ngModel)]="createCaseForm.dueDate"
                    name="dueDate"
                    required
                />

                <div class="flex flex-col">
                    <!-- Case Type  Selection -->
                    <ix-select
                        id="typeSelection"
                        (valueChange)="onTypeChange($event)"
                        (inputChange)="onTypeInputChange($event)"
                    >
                        <ix-select-item label="PLANNED" [value]="caseType.PLANNED"></ix-select-item>
                        <ix-select-item label="INCIDENT" [value]="caseType.INCIDENT"></ix-select-item>
                        <ix-select-item label="ANNOTATION" [value]="caseType.ANNOTATION"></ix-select-item>
                    </ix-select>

                    <ix-input-group class="absolute pointer-events-none" id="input-typeSelection">
                        <input
                            [(ngModel)]="createCaseForm.selectType"
                            placeholder="{{typePlaceholder()}}"
                            name="selectType"
                            required
                        />
                        <span slot="input-end">
                            <ix-icon name="chevron-down" size="16"/>
                        </span>
                    </ix-input-group>
                </div>

                <div class="flex flex-col">
                    <!-- Case Priority Selection -->
                    <ix-select
                        id="prioritySelection"
                        (valueChange)="onPriorityChange($event)"
                        (inputChange)="onPriorityInputChange($event)"
                    >
                        <ix-select-item label="LOW" [value]="casePriority.LOW"></ix-select-item>
                        <ix-select-item label="MEDIUM" [value]="casePriority.MEDIUM"></ix-select-item>
                        <ix-select-item label="HIGH" [value]="casePriority.HIGH"></ix-select-item>
                        <ix-select-item label="EMERGENCY" [value]="casePriority.EMERGENCY"></ix-select-item>
                    </ix-select>
                    <ix-input-group class="absolute pointer-events-none" id="input-prioritySelection">
                        <input
                            [(ngModel)]="createCaseForm.selectPriority"
                            placeholder="{{priorityPlaceholder()}}"
                            name="selectPriority"
                            required
                        />
                        <span slot="input-end">
                            <ix-icon name="chevron-down" size="16"/>
                        </span>
                    </ix-input-group>
                </div>
            </div>

            <!-- Case Email Input -->
            <ix-input-group>
                <span slot="input-start">Email:</span>
                <input
                    placeholder="example@domain.com"
                    type="email"
                    name="email"
                    [(ngModel)]="createCaseForm.email"
                    required
                />
                <div class="valid-feedback">Looks good!</div>
                <div class="invalid-feedback">Please provide a valid email address</div>
            </ix-input-group>
            
            <!-- Case Creation Button -->
            <ix-button type="submit">Create Case</ix-button>
        </form>

        <div *ngIf="getFacility() as facility">
            <ix-tile size="big" class="mr-1">
                <div class="mt-4" slot="header">{{ facility.heading }}</div>
                <div class="mt-7 text-l">{{ facility.subheading }}</div>
            </ix-tile>

            <ix-tile class="mt-2" size="small">
                Location: {{ facility.location }}
            </ix-tile>

            <ix-tile class="mt-2" size="small">
                Number of pumps: {{ facility.pumps }}
            </ix-tile>

            <ix-button
                class="mt-4"
                variant="secondary"
                [routerLink]="['/facilities', facility.id]"
            >
                View Facility
            </ix-button>
        </div>
    </div>
</ix-content>
